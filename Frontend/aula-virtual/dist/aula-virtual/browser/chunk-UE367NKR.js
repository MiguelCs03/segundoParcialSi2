import{a as Y}from"./chunk-UOSVOCXT.js";import"./chunk-KOVQJSC4.js";import{a as N}from"./chunk-ZBMPO245.js";import{b as G,c as U,f as z,i as H,j as J,k as K,o as Q,p as X}from"./chunk-L7N6OICC.js";import"./chunk-I3GQ3KJJ.js";import{$ as u,B as V,Ca as W,Da as y,Ea as T,Fa as L,G as s,Ga as B,I as g,Ia as C,J as b,N as p,Q as l,Sa as q,T as F,U as t,Ua as I,V as i,W as P,Z as x,_ as m,a as A,fa as a,ga as h,ha as f,ia as j,ja as R,ka as D,la as E,ma as S,pa as O,w as _,x as v}from"./chunk-4LX2SAQG.js";var M=class o{constructor(n){this.router=n}curso;detalleMateriaId;detalleClick=new V;enviarNotificacionRapida(){this.router.navigate(["/profesor/dashboard"],{queryParams:{tab:"notificaciones",materia:this.detalleMateriaId}})}static \u0275fac=function(e){return new(e||o)(g(I))};static \u0275cmp=b({type:o,selectors:[["app-course-card"]],inputs:{curso:"curso",detalleMateriaId:"detalleMateriaId"},outputs:{detalleClick:"detalleClick"},decls:10,vars:1,consts:[[1,"bg-white","rounded-lg","shadow-md","p-6","hover:shadow-lg","transition-shadow"],[1,"text-lg","font-semibold","mb-2","text-gray-800"],[1,"text-gray-600","mb-4"],[1,"space-y-2"],[1,"w-full","bg-blue-600","text-white","py-2","px-4","rounded","hover:bg-blue-700","transition-colors",3,"click"],[1,"w-full","bg-green-600","text-white","py-2","px-4","rounded","hover:bg-green-700","transition-colors",3,"click"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"h3",1),a(2),i(),t(3,"p",2),a(4,"Gestiona tu materia y estudiantes"),i(),t(5,"div",3)(6,"button",4),m("click",function(){return r.detalleClick.emit(r.detalleMateriaId)}),a(7," \u{1F4CA} Ver Detalles "),i(),t(8,"button",5),m("click",function(){return r.enviarNotificacionRapida()}),a(9," \u{1F4F1} Notificar Estudiantes "),i()()()),e&2&&(s(2),h(r.curso))},dependencies:[C],encapsulation:2})};var oe=(o,n)=>({"bg-green-50 border border-green-200":o,"bg-red-50 border border-red-200":n}),ae=(o,n)=>({"text-green-800":o,"text-red-800":n});function re(o,n){if(o&1&&(t(0,"option",33),a(1),i()),o&2){let e=n.$implicit;l("value",e.detalle_id),s(),R(" ",e.materia," - ",e.curso," ",e.paralelo," ")}}function se(o,n){if(o&1&&(t(0,"div",34)(1,"p",35),a(2," \u{1F4DA} Enviando a estudiantes y tutores de: "),t(3,"strong"),a(4),i()()()),o&2){let e=n.ngIf;s(4),h(e.nombre)}}function le(o,n){o&1&&(t(0,"span",44),a(1,"\u26A0\uFE0F Sin FCM"),i())}function ce(o,n){o&1&&(t(0,"span",45),a(1,"\u{1F4F1}"),i())}function de(o,n){if(o&1){let e=x();t(0,"label",39)(1,"input",40),m("change",function(c){let d=_(e).$implicit,k=u(2);return v(k.toggleDestinatario(d.id,c))}),i(),t(2,"span",41),a(3),p(4,le,2,0,"span",42)(5,ce,2,0,"span",43),i()()}if(o&2){let e=n.$implicit,r=u(2);s(),l("value",e.id)("checked",r.isDestinatarioSeleccionado(e.id)),s(2),j(" ",e.nombre," (",e.codigo,") "),s(),l("ngIf",!e.tiene_fcm_token),s(),l("ngIf",e.tiene_fcm_token)}}function me(o,n){if(o&1&&(t(0,"div")(1,"h4",36),a(2),i(),t(3,"div",37),p(4,de,6,6,"label",38),i()()),o&2){let e=u();s(2),f("\u{1F393} Estudiantes (",e.getEstudiantes().length,")"),s(2),l("ngForOf",e.getEstudiantes())}}function ue(o,n){if(o&1&&(t(0,"span",47),a(1),i()),o&2){let e=u().$implicit;s(),f(" - Tutor de ",e.estudiante_asociado," ")}}function pe(o,n){o&1&&(t(0,"span",44),a(1,"\u26A0\uFE0F Sin FCM"),i())}function fe(o,n){o&1&&(t(0,"span",45),a(1,"\u{1F4F1}"),i())}function ge(o,n){if(o&1){let e=x();t(0,"label",39)(1,"input",40),m("change",function(c){let d=_(e).$implicit,k=u(2);return v(k.toggleDestinatario(d.id,c))}),i(),t(2,"span",41),a(3),p(4,ue,2,1,"span",46)(5,pe,2,0,"span",42)(6,fe,2,0,"span",43),i()()}if(o&2){let e=n.$implicit,r=u(2);s(),l("value",e.id)("checked",r.isDestinatarioSeleccionado(e.id)),s(2),j(" ",e.nombre," (",e.codigo,") "),s(),l("ngIf",e.estudiante_asociado),s(),l("ngIf",!e.tiene_fcm_token),s(),l("ngIf",e.tiene_fcm_token)}}function _e(o,n){if(o&1&&(t(0,"div")(1,"h4",36),a(2),i(),t(3,"div",37),p(4,ge,7,7,"label",38),i()()),o&2){let e=u();s(2),f("\u{1F468}\u200D\u{1F469}\u200D\u{1F467}\u200D\u{1F466} Tutores (",e.getTutores().length,")"),s(2),l("ngForOf",e.getTutores())}}function ve(o,n){o&1&&(t(0,"span"),a(1,"\u{1F4E4} Enviar Notificaci\xF3n"),i())}function be(o,n){o&1&&(t(0,"span"),a(1,"\u23F3 Enviando..."),i())}function xe(o,n){if(o&1&&(t(0,"div",52)(1,"p"),a(2,"\u{1F4CA} "),t(3,"strong"),a(4,"Enviadas:"),i(),a(5),i(),t(6,"p"),a(7,"\u274C "),t(8,"strong"),a(9,"Fallidas:"),i(),a(10),i(),t(11,"p"),a(12,"\u{1F4F1} "),t(13,"strong"),a(14,"Total:"),i(),a(15),i()()),o&2){let e=u(2);s(5),f(" ",e.resultadoEnvio.enviadas,""),s(5),f(" ",e.resultadoEnvio.fallidas,""),s(5),f(" ",e.resultadoEnvio.total,"")}}function he(o,n){if(o&1&&(t(0,"div",53)(1,"p"),a(2),i()()),o&2){let e=u(2);s(2),h(e.resultadoEnvio.error)}}function Ce(o,n){if(o&1&&(t(0,"div",48)(1,"h4",49),a(2),i(),p(3,xe,16,3,"div",50)(4,he,3,1,"div",51),i()),o&2){let e=u();l("ngClass",O(5,oe,e.resultadoEnvio.success,!e.resultadoEnvio.success)),s(),l("ngClass",O(8,ae,e.resultadoEnvio.success,!e.resultadoEnvio.success)),s(),f(" ",e.resultadoEnvio.success?"\u2705 Notificaci\xF3n Enviada":"\u274C Error al Enviar"," "),s(),l("ngIf",e.resultadoEnvio.success),s(),l("ngIf",!e.resultadoEnvio.success)}}function De(o,n){o&1&&(t(0,"div",54)(1,"div",55),a(2,"\u{1F465}"),i(),t(3,"p"),a(4,"No se encontraron destinatarios para esta materia"),i()())}var w=class o{constructor(n){this.profesorService=n}materiaPreseleccionada;materias=[];selectedMateria="";destinatarios=null;destinatariosSeleccionados=[];enviando=!1;resultadoEnvio=null;notificacion={titulo:"",mensaje:"",tipo:"general"};ngOnInit(){this.cargarMaterias(),this.materiaPreseleccionada&&(this.selectedMateria=this.materiaPreseleccionada),this.cargarDestinatarios()}getEstudiantes(){return this.destinatarios?.estudiantes||[]}getTutores(){return this.destinatarios?.tutores||[]}getMensajeLength(){return this.notificacion.mensaje?.length||0}sinDestinatarios(){return this.destinatarios!==null&&this.getEstudiantes().length===0&&this.getTutores().length===0}isDestinatarioSeleccionado(n){return this.destinatariosSeleccionados.includes(n)}cargarMaterias(){this.profesorService.getMateriasConCurso().subscribe(n=>this.materias=n,n=>console.error("Error cargando materias:",n))}cargarDestinatarios(){let n=this.selectedMateria?parseInt(this.selectedMateria):void 0;this.profesorService.obtenerDestinatarios(n).subscribe(e=>{this.destinatarios=e,this.destinatariosSeleccionados=[],console.log("Destinatarios cargados:",e)},e=>{console.error("Error cargando destinatarios:",e),this.destinatarios={estudiantes:[],tutores:[]}})}toggleDestinatario(n,e){e.target.checked?this.destinatariosSeleccionados.includes(n)||this.destinatariosSeleccionados.push(n):this.destinatariosSeleccionados=this.destinatariosSeleccionados.filter(r=>r!==n)}seleccionarTodos(){this.destinatariosSeleccionados=[],this.destinatarios&&(this.destinatarios.estudiantes.forEach(n=>this.destinatariosSeleccionados.push(n.id)),this.destinatarios.tutores.forEach(n=>this.destinatariosSeleccionados.push(n.id)))}deseleccionarTodos(){this.destinatariosSeleccionados=[]}seleccionarSoloEstudiantes(){this.destinatariosSeleccionados=[],this.destinatarios&&this.destinatarios.estudiantes.forEach(n=>this.destinatariosSeleccionados.push(n.id))}seleccionarSoloTutores(){this.destinatariosSeleccionados=[],this.destinatarios&&this.destinatarios.tutores.forEach(n=>this.destinatariosSeleccionados.push(n.id))}puedeEnviar(){return this.notificacion.titulo.trim()!==""&&this.notificacion.mensaje.trim()!==""&&this.destinatariosSeleccionados.length>0}enviarNotificacion(){if(!this.puedeEnviar())return;this.enviando=!0,this.resultadoEnvio=null;let n={destinatarios:this.destinatariosSeleccionados,titulo:this.notificacion.titulo.trim(),mensaje:this.notificacion.mensaje.trim(),tipo:this.notificacion.tipo};this.profesorService.enviarNotificacionMasiva(n).subscribe(e=>{this.resultadoEnvio=A({success:!0},e),this.limpiarFormulario(),this.enviando=!1,console.log("Notificaci\xF3n enviada:",e)},e=>{this.resultadoEnvio={success:!1,error:e.error?.error||"Error desconocido al enviar notificaci\xF3n"},this.enviando=!1,console.error("Error enviando notificaci\xF3n:",e)})}limpiarFormulario(){this.notificacion={titulo:"",mensaje:"",tipo:"general"},this.destinatariosSeleccionados=[],this.resultadoEnvio=null}static \u0275fac=function(e){return new(e||o)(g(N))};static \u0275cmp=b({type:o,selectors:[["app-notificaciones"]],inputs:{materiaPreseleccionada:"materiaPreseleccionada"},decls:65,vars:15,consts:[[1,"bg-white","rounded-lg","shadow","p-6"],[1,"text-xl","font-bold","mb-4","text-gray-800"],[1,"mb-4","space-y-3"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"w-full","p-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mb-4 p-3 bg-blue-50 rounded-md",4,"ngIf"],[1,"mb-4"],[1,"text-lg","font-semibold","mb-2","text-gray-800"],[1,"flex","gap-4","mb-3"],[1,"px-3","py-1","bg-blue-600","text-white","rounded","text-sm","hover:bg-blue-700",3,"click"],[1,"px-3","py-1","bg-gray-600","text-white","rounded","text-sm","hover:bg-gray-700",3,"click"],[1,"px-3","py-1","bg-green-600","text-white","rounded","text-sm","hover:bg-green-700",3,"click"],[1,"px-3","py-1","bg-purple-600","text-white","rounded","text-sm","hover:bg-purple-700",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[4,"ngIf"],[1,"text-sm","text-gray-600","mt-2"],[1,"space-y-4"],["type","text","placeholder","Ingrese el t\xEDtulo de la notificaci\xF3n","maxlength","100",1,"w-full","p-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["placeholder","Escriba el mensaje de la notificaci\xF3n","rows","4","maxlength","500",1,"w-full","p-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-500","mt-1"],[1,"w-full","p-2","border","border-gray-300","rounded-md","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["value","general"],["value","tarea"],["value","examen"],["value","evento"],["value","urgente"],[1,"flex","gap-3","mt-6"],[1,"flex-1","bg-blue-600","text-white","py-2","px-4","rounded-md","hover:bg-blue-700","disabled:bg-gray-400","disabled:cursor-not-allowed",3,"click","disabled"],[1,"px-4","py-2","border","border-gray-300","text-gray-700","rounded-md","hover:bg-gray-50",3,"click"],["class","mt-4 p-4 rounded-md",3,"ngClass",4,"ngIf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[3,"value"],[1,"mb-4","p-3","bg-blue-50","rounded-md"],[1,"text-sm","text-blue-800"],[1,"font-medium","text-gray-700","mb-2"],[1,"max-h-48","overflow-y-auto","border","border-gray-200","rounded","p-2"],["class","flex items-center space-x-2 p-1 hover:bg-gray-50 rounded",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2","p-1","hover:bg-gray-50","rounded"],["type","checkbox",1,"rounded","border-gray-300",3,"change","value","checked"],[1,"text-sm","flex-1"],["class","text-red-500 text-xs",4,"ngIf"],["class","text-green-500 text-xs",4,"ngIf"],[1,"text-red-500","text-xs"],[1,"text-green-500","text-xs"],["class","text-gray-500 text-xs",4,"ngIf"],[1,"text-gray-500","text-xs"],[1,"mt-4","p-4","rounded-md",3,"ngClass"],[1,"font-medium","mb-2",3,"ngClass"],["class","text-sm text-green-700",4,"ngIf"],["class","text-sm text-red-700",4,"ngIf"],[1,"text-sm","text-green-700"],[1,"text-sm","text-red-700"],[1,"text-center","py-8","text-gray-500"],[1,"text-4xl","mb-2"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"h2",1),a(2,"\u{1F4F1} Enviar Notificaciones"),i(),t(3,"div",2)(4,"div")(5,"label",3),a(6," Filtrar por materia (opcional) "),i(),t(7,"select",4),S("ngModelChange",function(d){return E(r.selectedMateria,d)||(r.selectedMateria=d),d}),m("change",function(){return r.cargarDestinatarios()}),t(8,"option",5),a(9,"Todos los estudiantes y tutores"),i(),p(10,re,2,4,"option",6),i()()(),p(11,se,5,1,"div",7),t(12,"div",8)(13,"h3",9),a(14,"\u{1F465} Seleccionar Destinatarios"),i(),t(15,"div",10)(16,"button",11),m("click",function(){return r.seleccionarTodos()}),a(17," Seleccionar Todos "),i(),t(18,"button",12),m("click",function(){return r.deseleccionarTodos()}),a(19," Deseleccionar Todos "),i(),t(20,"button",13),m("click",function(){return r.seleccionarSoloEstudiantes()}),a(21," Solo Estudiantes "),i(),t(22,"button",14),m("click",function(){return r.seleccionarSoloTutores()}),a(23," Solo Tutores "),i()(),t(24,"div",15),p(25,me,5,2,"div",16)(26,_e,5,2,"div",16),i(),t(27,"p",17),a(28," Seleccionados: "),t(29,"strong"),a(30),i(),a(31," destinatarios "),i()(),t(32,"div",18)(33,"div")(34,"label",3),a(35,"T\xEDtulo *"),i(),t(36,"input",19),S("ngModelChange",function(d){return E(r.notificacion.titulo,d)||(r.notificacion.titulo=d),d}),i()(),t(37,"div")(38,"label",3),a(39,"Mensaje *"),i(),t(40,"textarea",20),S("ngModelChange",function(d){return E(r.notificacion.mensaje,d)||(r.notificacion.mensaje=d),d}),i(),t(41,"p",21),a(42),i()(),t(43,"div")(44,"label",3),a(45,"Tipo"),i(),t(46,"select",22),S("ngModelChange",function(d){return E(r.notificacion.tipo,d)||(r.notificacion.tipo=d),d}),t(47,"option",23),a(48,"\u{1F4E2} General"),i(),t(49,"option",24),a(50,"\u{1F4DD} Tarea"),i(),t(51,"option",25),a(52,"\u{1F4CA} Examen"),i(),t(53,"option",26),a(54,"\u{1F4C5} Evento"),i(),t(55,"option",27),a(56,"\u{1F6A8} Urgente"),i()()()(),t(57,"div",28)(58,"button",29),m("click",function(){return r.enviarNotificacion()}),p(59,ve,2,0,"span",16)(60,be,2,0,"span",16),i(),t(61,"button",30),m("click",function(){return r.limpiarFormulario()}),a(62," \u{1F5D1}\uFE0F Limpiar "),i()(),p(63,Ce,5,11,"div",31)(64,De,5,0,"div",32),i()),e&2&&(s(7),D("ngModel",r.selectedMateria),s(3),l("ngForOf",r.materias),s(),l("ngIf",r.destinatarios==null?null:r.destinatarios.materia_info),s(14),l("ngIf",r.getEstudiantes().length>0),s(),l("ngIf",r.getTutores().length>0),s(4),h(r.destinatariosSeleccionados.length),s(6),D("ngModel",r.notificacion.titulo),s(4),D("ngModel",r.notificacion.mensaje),s(2),f("",r.getMensajeLength(),"/500 caracteres"),s(4),D("ngModel",r.notificacion.tipo),s(12),l("disabled",!r.puedeEnviar()||r.enviando),s(),l("ngIf",!r.enviando),s(),l("ngIf",r.enviando),s(3),l("ngIf",r.resultadoEnvio),s(),l("ngIf",r.sinDestinatarios()))},dependencies:[C,W,y,T,X,J,K,G,H,U,Q,z],encapsulation:2})};function Ee(o,n){if(o&1){let e=x();t(0,"app-course-card",16),m("detalleClick",function(c){_(e);let d=u(2);return v(d.irADetalle(c))}),i()}if(o&2){let e=n.$implicit;l("curso",e.materia+" - "+e.curso+" "+e.paralelo)("detalleMateriaId",e.detalle_id)}}function Se(o,n){o&1&&(t(0,"div",17)(1,"div",18),a(2,"\u{1F4DA}"),i(),t(3,"h3",19),a(4,"No hay materias asignadas"),i(),t(5,"p",20),a(6,"Contacta al administrador para que te asigne materias."),i()())}function ye(o,n){if(o&1){let e=x();t(0,"div")(1,"div",9)(2,"button",10),a(3," \u270F\uFE0F Nueva Tarea "),i(),t(4,"button",11),a(5," \u{1F465} Gestionar Alumnos "),i(),t(6,"button",12),m("click",function(){_(e);let c=u();return v(c.activeTab="notificaciones")}),a(7," \u{1F4E4} Enviar Notificaci\xF3n "),i()(),t(8,"div",13),p(9,Ee,1,2,"app-course-card",14),i(),p(10,Se,7,0,"div",15),i()}if(o&2){let e=u();s(9),l("ngForOf",e.materias),s(),l("ngIf",e.materias.length===0)}}function Te(o,n){if(o&1&&(t(0,"div"),P(1,"app-notificaciones",21),i()),o&2){let e=u();s(),l("materiaPreseleccionada",e.materiaPreseleccionada)}}var ee=class o{constructor(n,e,r){this.profesorService=n;this.router=e;this.route=r}materias=[];activeTab="materias";materiaPreseleccionada="";ngOnInit(){this.profesorService.getMateriasConCurso().subscribe(n=>{console.log("Materias recibidas:",n),this.materias=n},n=>{console.error("Error cargando materias:",n)}),this.route.queryParams.subscribe(n=>{n.tab==="notificaciones"&&(this.activeTab="notificaciones"),n.materia&&(this.materiaPreseleccionada=n.materia)})}irADetalle(n){this.router.navigate(["/profesor/materia",n])}static \u0275fac=function(e){return new(e||o)(g(N),g(I),g(q))};static \u0275cmp=b({type:o,selectors:[["app-profesor-dashboard"]],decls:15,vars:7,consts:[[1,"flex","min-h-screen","bg-gray-50"],[1,"flex-1","p-6"],[1,"max-w-7xl","mx-auto"],[1,"text-3xl","font-bold","mb-6","text-gray-800"],[1,"mb-6","border-b","border-gray-200"],[1,"-mb-px","flex","space-x-8"],[1,"whitespace-nowrap","py-2","px-1","border-b-2","font-medium","text-sm",3,"click"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"mb-6","flex","gap-4"],[1,"bg-blue-700","text-white","px-6","py-2","rounded-lg","hover:bg-blue-800","transition-colors"],[1,"border","border-blue-700","text-blue-700","px-6","py-2","rounded-lg","hover:bg-blue-50","transition-colors"],[1,"bg-green-600","text-white","px-6","py-2","rounded-lg","hover:bg-green-700","transition-colors",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"curso","detalleMateriaId","detalleClick",4,"ngFor","ngForOf"],["class","text-center py-12",4,"ngIf"],[3,"detalleClick","curso","detalleMateriaId"],[1,"text-center","py-12"],[1,"text-gray-400","text-6xl","mb-4"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-500"],[3,"materiaPreseleccionada"]],template:function(e,r){e&1&&(t(0,"div",0),P(1,"app-sidebar"),t(2,"div",1)(3,"div",2)(4,"h1",3),a(5,"\u{1F468}\u200D\u{1F3EB} Dashboard del Profesor"),i(),t(6,"div",4)(7,"nav",5)(8,"button",6),m("click",function(){return r.activeTab="materias"}),a(9," \u{1F4DA} Mis Materias "),i(),t(10,"button",6),m("click",function(){return r.activeTab="notificaciones"}),a(11," \u{1F4F1} Notificaciones "),i()()(),t(12,"div",7),p(13,ye,11,2,"div",8)(14,Te,2,1,"div",8),i()()()()),e&2&&(s(8),F(r.activeTab==="materias"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),s(2),F(r.activeTab==="notificaciones"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),s(2),l("ngSwitch",r.activeTab),s(),l("ngSwitchCase","materias"),s(),l("ngSwitchCase","notificaciones"))},dependencies:[C,y,T,L,B,Y,M,w],encapsulation:2})};export{ee as ProfesorDashboardComponent};
