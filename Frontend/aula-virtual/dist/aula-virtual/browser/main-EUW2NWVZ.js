import{a as d}from"./chunk-KOVQJSC4.js";import{a as F}from"./chunk-I3GQ3KJJ.js";import{Aa as R,I as g,J as M,Ja as T,La as k,Ma as I,Na as N,Oa as j,Qa as w,Ra as E,Ta as D,Ua as s,W as A,Wa as x,d as v,f,i as C,j as u,k as S,m as h,q as y,t as b,u as p,va as H}from"./chunk-4LX2SAQG.js";var a=()=>{let e=p(d),t=p(s);return e.isLoggedIn||t.createUrlTree(["/login"])};function i(e){return()=>{let t=p(d),o=p(s),r=t.role?.toLowerCase(),n=e.map(c=>c.toLowerCase());return t.isLoggedIn&&r&&n.includes(r)?!0:o.createUrlTree(["/no-autorizado"])}}var z=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",loadComponent:()=>import("./chunk-WPZCQKBE.js").then(e=>e.default)},{path:"profesor",canActivate:[a,i(["profesor"])],loadComponent:()=>import("./chunk-UE367NKR.js").then(e=>e.ProfesorDashboardComponent)},{path:"profesor/materia/:id",canActivate:[a,i(["profesor"])],loadComponent:()=>import("./chunk-QL5B5UOL.js").then(e=>e.MateriaDetalleComponent)},{path:"mi-rendimiento",canActivate:[a,i(["estudiante"])],loadComponent:()=>import("./chunk-WNWREYMW.js").then(e=>e.AlumnoDashboardComponent)},{path:"mi-rendimiento/materia/:id",canActivate:[a,i(["estudiante"])],loadComponent:()=>import("./chunk-2OGCNHUR.js").then(e=>e.AlumnoMateriaDetalleComponent)},{path:"mi-hijo",canActivate:[a,i(["tutor"])],loadComponent:()=>import("./chunk-KZYZSOFE.js").then(e=>e.TutorDashboardComponent)},{path:"profesor/materia/:id/asistencia",canActivate:[a,i(["profesor"])],loadComponent:()=>import("./chunk-3GY24275.js").then(e=>e.default)},{path:"profesor/materia/:id/reporte-asistencia",loadComponent:()=>import("./chunk-YLGA224W.js").then(e=>e.default),canActivate:[a,i(["profesor"])]},{path:"profesor/materia/:id/crear-actividad",canActivate:[a,i(["profesor"])],loadComponent:()=>import("./chunk-UBKU2G52.js").then(e=>e.CrearActividadComponent)},{path:"profesor/materia/:id/actividad/:actividadId/calificar",canActivate:[a,i(["profesor"])],loadComponent:()=>import("./chunk-6JUYPVRI.js").then(e=>e.CalificarActividadComponent)},{path:"profesor/materia/:id/reporte-entregas",canActivate:[a,i(["profesor"])],loadComponent:()=>import("./chunk-WTR6BGHN.js").then(e=>e.ReporteEntregasComponent)},{path:"no-autorizado",loadComponent:()=>import("./chunk-GLRUINCD.js").then(e=>e.NoAutorizadoComponent)}];var m=class e{constructor(t){this.http=t}isRefreshing=!1;refreshTokenSubject=new v(null);intercept(t,o){console.log("Interceptando petici\xF3n HTTP, url:",t.url);let r=localStorage.getItem("access_token");r?console.log("Access token disponible:",r.substring(0,10)+"..."):console.log("No hay access token");let n=t;return r&&(n=this.addTokenHeader(t,r)),o.handle(n).pipe(u(c=>c instanceof k&&c.status===401?this.handle401Error(n,o):f(()=>c)))}addTokenHeader(t,o){return t.clone({headers:t.headers.set("Authorization","Bearer "+o)})}handle401Error(t,o){if(!this.isRefreshing){this.isRefreshing=!0,this.refreshTokenSubject.next(null);let r=localStorage.getItem("refresh_token");if(r)return this.http.post(F.apiUrl+"api/token/refresh/",{refresh:r}).pipe(h(n=>(this.isRefreshing=!1,localStorage.setItem("access_token",n.access),this.refreshTokenSubject.next(n.access),o.handle(this.addTokenHeader(t,n.access)))),u(n=>(this.isRefreshing=!1,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),window.location.href="/login",f(()=>n))))}return this.refreshTokenSubject.pipe(C(r=>r!==null),S(1),h(r=>o.handle(this.addTokenHeader(t,r))))}static \u0275fac=function(o){return new(o||e)(b(I))};static \u0275prov=y({token:e,factory:e.\u0275fac})};var P={providers:[H({eventCoalescing:!0}),x(z),j(),E(w()),{provide:N,useClass:m,multi:!0}]};var l=class e{constructor(t,o){this.session=t;this.router=o;R(()=>{this.session.usuarioSignal()||(console.log("\u{1F504} Usuario desconectado \u2192 redirigiendo a /login"),this.router.navigate(["/login"]))})}static \u0275fac=function(o){return new(o||e)(g(d),g(s))};static \u0275cmp=M({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(o,r){o&1&&A(0,"router-outlet")},dependencies:[D],encapsulation:2})};T(l,P).catch(e=>console.error(e));
