import './polyfills.server.mjs';
import{a as c}from"./chunk-5BW553ZL.mjs";import{G as n,Hb as l,l as a,o as s,r as i,xb as u}from"./chunk-5PD2IZO4.mjs";var g=class o{constructor(t,r){this.router=t;this.http=r;if(typeof localStorage<"u"){let e=localStorage.getItem(this.storageKey);try{let m=e?JSON.parse(e):null;this.usuario.set(m)}catch{localStorage.removeItem(this.storageKey),this.usuario.set(null)}}}usuario=n(null);storageKey="usuario";login(t,r){return this.http.post(c.apiUrl+"api/login/",{codigo:t,password:r}).pipe(a(e=>{localStorage.setItem("access_token",e.access),localStorage.setItem("refresh_token",e.refresh),console.log("Rol recibido:",e.usuario.rol?.nombre),this.setUsuario(e.usuario),this.redireccionarPorRol(e.usuario.rol?.nombre)}))}redireccionarPorRol(t){switch(t){case"admin":this.router.navigate(["/admin"]);break;case"profesor":this.router.navigate(["/profesor"]);break;case"estudiante":this.router.navigate(["/mi-rendimiento"]);break;case"tutor":this.router.navigate(["/mi-hijo"]);break;default:this.router.navigate(["/"])}}setUsuario(t){this.usuario.set(t),typeof localStorage<"u"&&localStorage.setItem(this.storageKey,JSON.stringify(t))}logout(){this.usuario.set(null),typeof localStorage<"u"&&(localStorage.removeItem(this.storageKey),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")),this.router.navigate(["/login"])}get usuarioSignal(){return this.usuario}get currentUser(){return this.usuario()}get role(){return this.usuario()?.rol?.nombre}get isLoggedIn(){return!!this.usuario()}static \u0275fac=function(r){return new(r||o)(i(l),i(u))};static \u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})};export{g as a};
